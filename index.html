<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Café San Gregoryo Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:0;}
    header { background:#7b3f00; color:#fff; padding:16px; text-align:center; }
    table { width: 95%; margin:20px auto; border-collapse: collapse; }
    th, td { padding:10px; border:1px solid #ccc; text-align:left; }
    th { background:#dba15a; color:#fff; }
    .items-list { list-style:none; padding-left:0; margin:0;}
    .delete-btn { background:#e74c3c; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <h1>Admin Panel — Café San Gregoryo Orders</h1>
  </header>

  <table>
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Customer Name</th>
        <th>Items</th>
        <th>Total (₱)</th>
        <th>Note</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="ordersTable">
      <!-- Orders will be injected here -->
    </tbody>
  </table>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
    import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC7QVhaR95hO_dUYcP7dJ__2DW0blpMKFI",
      authDomain: "la-mesa-cafe-system.firebaseapp.com",
      databaseURL: "https://la-mesa-cafe-system-default-rtdb.firebaseio.com",
      projectId: "la-mesa-cafe-system",
      storageBucket: "la-mesa-cafe-system.appspot.com",
      messagingSenderId: "234244615396",
      appId: "1:234244615396:web:87725489a3f70fbbabd0f1",
      measurementId: "G-9CL7KJTYVB"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const ordersRef = ref(db, 'orders');

    function renderOrders(orders) {
      const tbody = document.getElementById('ordersTable');
      tbody.innerHTML = '';

      orders.forEach(order => {
        const tr = document.createElement('tr');

        // Render items list
        const itemsList = document.createElement('ul');
        itemsList.className = 'items-list';
        order.items.forEach(item => {
          const li = document.createElement('li');
          li.textContent = `${item.name} × ${item.qty} (₱${item.price})`;
          itemsList.appendChild(li);
        });

        tr.innerHTML = `
          <td>${order.id}</td>
          <td>${order.name}</td>
          <td></td>
          <td>${order.total}</td>
          <td>${order.note}</td>
          <td><button class="delete-btn" data-id="${order.id}">Delete</button></td>
        `;
        tr.children[2].appendChild(itemsList);

        // Attach delete listener
        tr.querySelector('.delete-btn').addEventListener('click', () => {
          if(confirm('Are you sure you want to delete this order?')) {
            remove(ref(db, `orders/${order.id}`))
              .then(() => alert('Order deleted successfully!'))
              .catch(err => alert('Error deleting order: ' + err));
          }
        });

        tbody.appendChild(tr);
      });
    }

    // Real-time updates
    onValue(ordersRef, (snapshot) => {
      const data = snapshot.val();
      const orders = [];

      for (let key in data) {
        const o = data[key];
        orders.push({
          id: key,
          name: o.name || "Unknown Customer",
          total: o.total || 0,
          note: o.note || "",
          items: o.items || []
        });
      }

      renderOrders(orders);
    });
  </script>
</body>
</html>
