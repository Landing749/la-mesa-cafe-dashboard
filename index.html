<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>La Mesa Cafe â€” Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; background: #fffaf6; margin:0; padding:20px; }
    h1 { color: #7b3f00; }
    .order-card { background: #fff; padding:16px; margin-bottom:12px; border-radius:10px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); transition: 0.2s; }
    .order-card.completed { background: #e6f9e6; opacity: 0.8; }
    .order-header { display:flex; justify-content:space-between; align-items:center; }
    .btn { padding:6px 12px; border:none; border-radius:8px; cursor:pointer; font-weight:700; }
    .complete { background: #4CAF50; color:#fff; margin-left:6px; }
    .delete { background: #f44336; color:#fff; margin-left:6px; }
    .items { margin-top:8px; }
    .item { display:flex; justify-content:space-between; padding:4px 0; }
    .toggle-completed { margin-bottom:12px; }
  </style>
</head>
<body>
  <h1>La Mesa Cafe â€” Orders Panel</h1>
  <label class="toggle-completed">
    <input type="checkbox" id="hideCompleted"> Hide completed orders
  </label>
  <div id="ordersContainer"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getDatabase, ref, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC7QVhaR95hO_dUYcP7dJ__2DW0blpMKFI",
      authDomain: "la-mesa-cafe-system.firebaseapp.com",
      databaseURL: "https://la-mesa-cafe-system-default-rtdb.firebaseio.com",
      projectId: "la-mesa-cafe-system",
      storageBucket: "la-mesa-cafe-system.appspot.com",
      messagingSenderId: "234244615396",
      appId: "1:234244615396:web:87725489a3f70fbbabd0f1",
      measurementId: "G-9CL7KJTYVB"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const ordersRef = ref(db, 'orders');

    const ordersContainer = document.getElementById('ordersContainer');
    const hideCompletedCheckbox = document.getElementById('hideCompleted');

    function renderOrders(ordersObj){
      ordersContainer.innerHTML = '';
      if(!ordersObj) return;

      Object.entries(ordersObj).forEach(([id, order]) => {
        const completed = order.completed || false;
        if(hideCompletedCheckbox.checked && completed) return;

        const card = document.createElement('div');
        card.className = 'order-card' + (completed ? ' completed' : '');
        card.innerHTML = `
          <div class="order-header">
            <div><strong>${order.customer || 'Unknown Customer'}</strong> - â‚±${order.total}</div>
            <div>
              <button class="btn complete" ${completed ? 'disabled' : ''}>âœ… Complete</button>
              <button class="btn delete">ðŸ—‘ Delete</button>
            </div>
          </div>
          <div class="items">
            ${order.items.map(i => `<div class="item">${i.name} Ã— ${i.qty} <span>â‚±${i.price * i.qty}</span></div>`).join('')}
          </div>
          <div class="note" style="margin-top:6px; font-size:13px; color:#555;">Note: ${order.note || '-'}</div>
        `;
        ordersContainer.appendChild(card);

        const completeBtn = card.querySelector('.complete');
        const deleteBtn = card.querySelector('.delete');

        completeBtn.onclick = () => {
          update(ref(db, 'orders/' + id), { completed: true })
            .then(() => alert('Order marked as completed'))
            .catch(err => alert('Error: ' + err));
        };

        deleteBtn.onclick = () => {
          if(confirm('Delete this order?')) {
            remove(ref(db, 'orders/' + id))
              .then(() => alert('Order deleted'))
              .catch(err => alert('Error: ' + err));
          }
        };
      });
    }

    onValue(ordersRef, snapshot => {
      renderOrders(snapshot.val());
    });

    hideCompletedCheckbox.addEventListener('change', () => {
      onValue(ordersRef, snapshot => {
        renderOrders(snapshot.val());
      });
    });
  </script>
</body>
</html>
